
PROJECT_NAME = "Qonversion"
PROJECT_SCHEME = "Qonversion"
XCODE_PROJECT = "./#{PROJECT_NAME}.xcodeproj"

lane :tests do
  cocoapods(
    repo_update: false,
    podfile: "./Podfile"
  )

  run_tests(
    scheme: PROJECT_SCHEME,
    devices: ["iPhone 7"]
  )
end

lane :bump do |options|
  new_version = options[:version]

  update_plist(
    plist_path: "Framework/Info.plist",
    block: proc do |plist|
      plist[:CFBundleShortVersionString] = new_version
    end
  )

  version_bump_podspec(
    path: "Qonversion.podspec", 
    version_number: new_version
  )

  file_path = Dir['../**/QNConstants.m'].first
  file = File.read(file_path)
  new_content = file.gsub(/NSString \*const keyQVersion = @".*";/, "NSString *const keyQVersion = @\"#{new_version}\";")
  File.open(file_path, 'w') { |line| line.puts new_content }

end
